Option Explicit'********DO NOT remove or change the expand line or the included file contents******************'  MachStdMIll license terms REQUIRE that the copyright and License terms remain a part of this source file#expand <Masters\Headers\CopyRightAndLicenseNotice>	'**************************************************************************************#expand <Masters\Headers\MachConstants>' M6ATC macro for MSM_ATC screenset (based on MachStdMill from Calypso Ventures) - developed by sebba - 2020'	Developed and tested with MachStdMill v2.0.12 and MachScreen v1.72''	v1.00 - 2020.04.01 - First operational version'	v1.01 - 2020.04.13 - Configurable axis for rack alignment'	v1.02 - 2020.04.20 - Slot Sensors ON/OFF''	Features implemented:'		- Rack alignment option (along X or Y axis, selectable)'		- Unlimited number of tools, each slot (fork) can have any tool in it, configurable in ATC page'		- Abillity to manually load tools which are not loaded in rack '		- Abillity to unload tools which cannot be returned in rack (all slots are populated with tools)'		- Each slot can be manually enabled or disabled. '		- Checking for referenced machine - not start if machine is not referenced'		- Checking for Minimum Air operatin pressure - pressure reported by Arduino hardware interface and brain'		- Air Pressure checking can be Disabled in Settings/Spindles if sensor not available'		- Checking slot's sensors for tool presence'		- Slot sensors checking can be Enabled/Disabled (all of them) in Settings/Spindles by setting CheckZ = RackZ'		- Configurable timeout value (wait time for sensor's report)'		- Abillity to bypass and retry sensor's report if error'		- Configurable error level of reported messages for ATC operations'		- Check for wrong settings in ATC setup (invalid settings: step = 0, tcfeed = 0, clearZ = rackZ)''	To do:'		- slot's status LEDs to show detected errors (if tool declared in slot but slot sensor report tool is not loaded)'		- error messages cleanup and fix - some messages are still messed or have not proper level'		- individual enable/disable slot's sensor'		- spindle's internal sensors (depending on spindle type)'		- wide screenset'	DoSpinStop()                 ' Make sure the spindle is OFF	Code"M09"                    ' Make sure the coolant is OFF	'check all axis are enabled	If  GetOEMLed(86) Or  GetOemLED(87) Or  GetOemLed(88) Then 		DoOEMButton(MachResetOEMBtn)		MsgBox "ATC - Cannot start! One ore more axis are NOT ENABLED"		Exit Sub	End If	'check all axis are referenced	If  GetOEMLed(807) Or  GetOemLED(808) Or  GetOemLed(809) Then 		MsgBox "ATC - Cannot start! One or more axis are NOT REFERENCED"		DoOEMButton(MachResetOEMBtn)		Exit Sub	End If		'declarare variabile  	Dim newtool As Integer		'scula noua ceruta in spindle  	Dim oldtool As Integer		'scula existenta in spunda	  	Dim newslot As Integer		'slotul in care se regaseste newtool, daca exista  	Dim oldslot As Integer		'slotul in care se regaseste oldtool, daca exista  	Dim ooo As Integer  	Dim nnn As Integer  	Dim err_lvl As Integer		Dim cnt As Integer		'variabila ptr generare timeout in asteptarea semnalelor de la spindle		Dim rackSize As Integer		'variabila ptr setarea numarului maxim de sloturi in magazie (1-10)	rackSize = 1110		Dim minPressure As Double	'presiunea minima acceptata ptr operare ATC	minPressure = getoemdro(1922)		Dim sensorDelay As Integer	sensorDelay = getoemdro(1924)		Dim manualconfirm As Integer	'variabila ptr fereastra de dialog in caz de timeout error la senzori	manualconfirm = 0	    	'initiem variabilele    	newslot = 0  	oldslot = 0	ooo = 0	nnn = 0		'--------------------------------------------------------------------------------------------------	' ALL BELOW values are in Machine Coordinates		Dim rackX As Double		'pozitia initiala (slot 1) de schimbare a sculelor pe axa X	Dim rackY As Double		'pozitia de schimbare a sculelor pe axa Y	Dim rackZ As Double		'pozitia in care se elibereaza/incarca scula pe axa Z	Dim stepX As Double		'pasul de indexare ptr fiecare slot in parte	Dim clearY As Double	'pozitia pe Y ptr returnare scula (inainte de intrare in clema	Dim clearZ As Double	'pozitia pe Z ptr incarcare scula (clearance pe deasupra conurilor)	Dim tcfeed As Integer	'feedrate la care se face schimbarea sculelor	Dim checkZ As Double		'daca checkZ <> rackZ atunci oprim la checkZ ptr verifidcare senzor stare slot	Dim emptyZ As Double		'pozitia pe Z unde se ridica spindle gol, fara scula, ptr traversarea pe deasupra sculelor si incarcarea noii scule	Dim rackAxis As Integer		'determinam pe ce axa este aliniata magazia de scule (X sau Y)		rackX = getoemdro(1911)		rackY = getoemdro(1912)		rackZ = getoemdro(1913)		stepX = getoemdro(1914)		clearY = getoemdro(1915)		clearZ = getoemdro(1916)		tcfeed = getoemdro(1917)		err_lvl = getoemdro(1918)		checkZ = getoemdro(1920)	emptyZ = getoemdro(1923)	rackAxis = getoemled(1151)	' if rackAxis = 0 rack is on X-Axis; if rackAxis = -1 rack is on Y-Axis		' ALL ABOVE values are in Machine Coordinates	'--------------------------------------------------------------------------------------------------	'checking for invalid values (unconfigured ATC system)	'if stepX = 0	If stepX = 0 Or clearZ = rackZ Or tcfeed = 0 Then 		DoOEMButton(MachResetOEMBtn)		MsgBox "ATC Setup - Invalid ATC Settings - Check Setup"		DoOEMButton(62)		Exit Sub	End If			  	oldtool = Getoemdro (1824) 		'citim numarul sculei existente in spindle	newtool = GetSelectedTool()		'citim numarul sculei cerute'if slot sensors are enabled	If GetOemLED(1152) <> 0 Then			'checking air pressure for min value		If err_lvl > 1 Then Message "ATC - Checking Air Pressure. Actual Pressure = " & getoemdro(1921) & " Bar"		cnt = 0		Do While getoemdro(1921) < minPressure And cnt < sensorDelay			If err_lvl > 3 Then Message "Checking Air Pressure. Actual Pressure = " & getoemdro(1921) & " Bar - " & Int((sensorDelay-cnt)/1000) & " s"			Sleep 250			cnt = cnt + 250			If cnt >= sensorDelay Then 				manualconfirm = MachMsg("Manual confirm air pressure restored!","Not enough air pressure for ATC operations",6)				If manualconfirm = 2 Then cnt = sensorDelay	'cancel2, ABORT3 - adica ii dam valoarea maxima de asteptare care duce in eroare				If manualconfirm = 10 Then cnt = 0		'tryagain10, RETRY4 				If manualconfirm = 11 Then minPressure = -100		'continue11, IGNORE5 			End If			If cnt >= sensorDelay And getoemdro(1921) < minPressure Then				If err_lvl > 0 Then Message "ATC - Not Enough Air pressure! Actual Pressure = " & getoemdro(1921) & " Bar - Required min. " & minPressure & " Bar"				sleep 50				DoOEMButton(1021)				Exit Sub			End If		Loop	End If		'case 0 - requested tool already loaded - don;t have to load same tool again	If oldtool = newtool Then Exit Sub	'iesire in caz ca sculele sunt identice si nu este nevoie de procesare	'case 1 - not same tool, searching if old tool have own slot already (was previously declared in rack)	'cautam daca exista deja pozitia lui oldtool in sloturi	For ooo = 1101 To rackSize	'	1110		If oldtool = Getoemdro(ooo) And getuserled(ooo + 30) = 1 Then 			oldslot = ooo			ooo = 1110	'rackSize+1	'1111		'iesim din for-next daca gasim slotul sculei		End If	Next ooo	'iesirea din bucla daca scula are slot propriu iar ooo are valoarea acelui slot'case 2 - tool does not have own slot, searching for free slot in rack => oldslot = first free slot in rack (110x)	'daca oldtool nu are slot propriu cautam slot liber 	If oldslot = 0 And oldtool > 0 Then			For ooo = 1101 To rackSize	'1110			If getoemdro(ooo) = 0 And getuserled(ooo + 30) = 1 Then 				oldslot = ooo				GoTo freeslot 	'iesim din bucla de cautare la primul slot gasit liber			End If		Next ooo	freeslot:				'iesirea din bucla de cautare a unui slot liber iar ooo are valoarea slotului liber gasit	End If	'tool have own slot, returning to it => oldslot = first free slot in rack (110x)	'daca oldtool > 0 si are slot propriu (sau exista slot liber declarat anterior) in magazie, 	'returnam scula in slotul aferent	If oldslot > 0 And oldtool > 0 Then						If err_lvl > 1 Then Message "ATC - Returning Tool T" & oldtool & " started!"			Sleep 50		'raising spindle to clear Z for ATC operations		If err_lvl > 3 Then Message "ATC - Moving to Safe Z" & clearZ		code "G0 G53 Z" & clearZ 						While IsMoving() 			Wend			'		'cheking slot sensors, function will report error status if sensors are enabled		If checkSlot(oldslot,1,"Returning Tool " & oldtool & " in Slot " & oldslot-1100) <> 1 Then			DoOEMButton(1021)			Exit Sub		End If			sleep 100		'moving spindle in front of receiver slot (oldslot, clearY)		Message "rackAxis = " & rackAxis				sleep 100				If rackAxis = 0 Then	' 0 means rack on X-Axis			If err_lvl > 3 Then Message "ATC - Returning Tool T" & oldtool & " - Moving for Slot " & oldslot-1100 & " at X" & rackX+((oldslot-1101)*stepX) & " Y" & clearY			code "G0 G53 X" & rackX+((oldslot-1101)*stepX)				While IsMoving() 				Wend			code "G0 G53 Y" & clearY				While IsMoving() 				Wend		Else	' 1 means rack on Y-Axis			If err_lvl > 3 Then Message "ATC - Returning Tool T" & oldtool & " - Moving for Slot " & oldslot-1100 & " at Y" & rackX+((oldslot-1101)*stepX) & " X" & clearY			code "G0 G53 Y" & rackX+((oldslot-1101)*stepX)				While IsMoving() 				Wend			code "G0 G53 X" & clearY				While IsMoving() 				Wend		End If				'wait for spindle to stop		If err_lvl > 2 Then Message "ATC - Waiting for spindle to stop..."		cnt = 0		Do While getoemdro(39) > 0 And cnt < sensorDelay			If err_lvl > 3 Then Message "ATC - Waiting for spindle to stop - " & Int((60000-cnt)/1000) & " s"			Sleep 250			cnt = cnt + 250			If cnt >= 60000 And getoemdro(39) > 0 Then				If err_lvl > 0 Then Message "ATC - Spindle still running! Error!"				sleep 50				DoOEMButton(1021)				Exit Sub			End If		Loop	'sfarsit bucla asteptare oprire spindle		'incepem suflarea aerului ptr curatare slot receptor					ActivateSignal(OUTPUT4)  				setuserled(1903,1)	'activating cone cleaning		'lowering spindle to releasing Z position (rackZ)				If err_lvl > 2 Then Message "ATC - Returning Tool T" & oldtool & " - Releasing tool at Z" & rackZ		code "G1 G53 Z" & rackZ & " F" & tcfeed			While IsMoving() 			Wend		'moving spindle into final docking position		If rackAxis = 0 Then	' 0 means rack on X-Axis			If err_lvl > 3 Then Message "ATC - Releasing Tool T" & oldtool & " in Slot " & oldslot-1100 & " at X" & rackX+((oldslot-1101)*stepX) & " Y" & rackY			code "G1 G53 Y" & rackY & " F" & tcfeed		'intoarcem scula in furca slotului aferent				While IsMoving()				Wend		Else			If err_lvl > 3 Then Message "ATC - Releasing Tool T" & oldtool & " in Slot " & oldslot-1100 & " at Y" & rackX+((oldslot-1101)*stepX) & " X" & rackY			code "G1 G53 X" & rackY & " F" & tcfeed		'intoarcem scula in furca slotului aferent				While IsMoving()				Wend		End If				'activating drawbar pentru eliberare scula		ActivateSignal(OUTPUT3)  		setuserled(1902,1)	'activating drawbar pentru eliberare scula				Sleep(500)		If GetOemLED(1152) <> 0 Then			'mutam in checkZ ptr verificare prezenta scula in slot dar doar daca senzorii sunt activati			If checkZ <> rackZ Then				If err_lvl > 2 Then Message "ATC - Moving to CheckZ. Tool T" & oldtool & " should be in Slot " & oldslot-1100				sleep 50				code "G1 G53 Z" & checkZ & " F" & tcfeed		'intoarcem scula in furca slotului aferent					While IsMoving()					Wend				'daca sloturile au senzori (adica avem rackZ <> checkZ) verificam daca slotul raporteaza scula ca fiind returnata la dupa ce mutam in checkZ				If checkSlot(oldslot,0,"Tool " & oldtool & " should be returned in Slot " & oldslot-1100) <> 0 Then					DoOEMButton(1021)					Exit Sub				End If			Else				'daca sloturile au senzori (adica avem rackZ <> checkZ) verificam daca slotul raporteaza scula ca fiind returnata la dupa ce mutam in checkZ				If checkSlot(oldslot,0,"Tool " & oldtool & " should be returned in Slot " & oldslot-1100) <> 0 Then					DoOEMButton(1021)					Exit Sub				End If			End If	'end If checkZ <> rackZ cu verificare stare slot inclusa		End If						setoemdro(ooo, oldtool)		'		setoemdro(824,0)		'spindle empty, deci setam tool 0						'extragem NRH/RH din GetToolDesc					If InStr(1, GetToolDesc(getoemdro(oldslot)), "NRH") > 0 Then 			SetUserLED(oldslot+100,1) 														Else			SetUserLED(oldslot+100,0) 																	End If								'aici trebuie adaugata ridicarea la "emptyZ", cota de deplasare a spindle-ului gol ptr incarcarea noi sculle existente in magazie		If emptyZ <> clearZ And getoemdro(84) = rackY Then 			If err_lvl > 3 Then Message "ATC Moving back to Empty Z" & emptyZ			code "G1 G53 Z" & emptyZ & " F" & tcfeed		'ridicam spindle la emptyZ deasupra holderelor			While IsMoving()			Wend		End If				If emptyZ = clearZ And getoemdro(84) <> rackY Then 			If err_lvl > 3 Then Message "ATC Moving back to Safe Z" & clearZ			code "G1 G53 Z" & clearZ & " F" & tcfeed		'ridicam spindle clearZ deasupra holderelor			While IsMoving()			Wend		End If		'oprire aer					setuserled(1902,0)	'deactivating drawbar		setuserled(1903,0)	'deactivating cone cleaning		DeactivateSignal(OUTPUT3)  		DeactivateSignal(OUTPUT4)  				'		Sleep(500)		'daca nu incarcam alta scula (newtool = 0) revenim pe clearY ptr intoarcere directa in TCP 		If rackAxis = 0 Then	' 0 means rack on X-Axis			If newtool = 0 Then				code "G0 G53 Y" & clearY					While IsMoving() 					Wend			End If		Else			If newtool = 0 Then				code "G0 G53 X" & clearY					While IsMoving() 					Wend			End If		End If'daca totusi nu exista slot liber asteptam eliberare manuala a sculei	ElseIf oldslot = 0 And oldtool > 0 Then	'daca totusi nu exista slot liber asteptam eliberare manuala a sculei		If err_lvl > 1 Then Message "Moving Spindle into SafeZ position for manual tool removal!"		'moving to TCP		Call RunScript("ScreenSetMacros\" & GetActiveScreenSetName() & "\" & "Masters\Scripts\Common\GoTCPosition")		Dim manualremove As Integer		manualremove = Machmsg ("Manually remove the tool from spindle! Press OK when done!","Manual tool",1)		'setuserled(1905,0)		'stingem ledul martor prezenta scula in spindle		If manualremove <> 1 Then DoOEMButton( 1021 ) 'reset		If manualremove = 1 Then If err_lvl > 1 Then Message "ATC - Tool was manually removed from spindle"							End If		'--- end of unloading tool --------------------	'newtool loading code'run only if newtool is not 0If newtool > 0 Then	If err_lvl > 1 Then Message "ATC - Start loading tool T" & newtool	Sleep 100	'searching newtool no in slots	For nnn = 1101 To rackSize	'1110			'if newtool is found in slots		If newtool = getoemdro(nnn) And getuserled(nnn + 30) = 1 Then 'cod incarcare aplicat DOAR cand scula este regasita in rack			newslot = nnn			nnn = 1110	'rackSize+1	'1110 'declaram fortat valoarea maxima a lui nnn ca sa iesim din bucla for-next odata ce am gasit slotul sculei					'checking slot sensor - it should report tool inside (not empty)			If checkSlot(newslot,0,"Loading Tool " & newtool & " from Slot " & newslot-1100) <> 0 Then				DoOEMButton(1021)				Exit Sub			End If			If emptyZ <> clearZ And getoemdro(84) = rackY Then 				If err_lvl > 3 Then Message "ATC - Moving back to Empty Z" & emptyZ				code "G1 G53 Z" & emptyZ & " F" & tcfeed		'ridicam spindle la emptyZ deasupra holderelor			End If			If emptyZ = clearZ  Or getoemdro(84) <> rackY Then 				If err_lvl > 3 Then Message "ATC - Moving back to Safe Z" & clearZ				code "G1 G53 Z" & clearZ & " F" & tcfeed		'ridicam spindle clearZ deasupra holderelor			End If			While IsMoving()				Wend			'checking rack orientation			If rackAxis = 0 Then	' 0 means rack on X-Axis				If err_lvl > 3 Then Message "ATC - Moving to Slot " & newslot-1100 & " at X" & rackX+((newslot-1101)*stepX) & " Y" & rackY				code "G0 G53 X" & rackX+((newslot-1101)*stepX) & " F" & tcfeed					While IsMoving() 					Wend				code "G0 G53 Y" & rackY & " F" & tcfeed				While IsMoving() 					Wend			Else				If err_lvl > 3 Then Message "ATC - Moving to Slot " & newslot-1100 & " at Y" & rackX+((newslot-1101)*stepX) & " X" & rackY				code "G0 G53 Y" & rackX+((newslot-1101)*stepX) & " F" & tcfeed					While IsMoving() 					Wend				code "G0 G53 X" & rackY & " F" & tcfeed				While IsMoving() 					Wend			End If			'activating drawbar for loading newtool			If err_lvl > 3 Then Message "ATC - Activating Drawbar and Air Cleaning"			ActivateSignal(OUTPUT3)  			ActivateSignal(OUTPUT4)  					setuserled(1902,1)	'activating drawbar			setuserled(1903,1)	'activating cone cleaning			Sleep(500)			'lowering into newltool loading position			If err_lvl > 3 Then Message "ATC - Moving for tool at Z" & rackZ			code "G1 G53 Z" & rackZ & " F" & tcfeed				While IsMoving() 				Wend							'deactivating drawbar for coupling newtool			If err_lvl > 3 Then Message "ATC - Deactivating drawbar"			setuserled(1902,0)	'deactivating drawbar			setuserled(1903,0)	'deactivating cone cleaning			DeactivateSignal(OUTPUT3)  			DeactivateSignal(OUTPUT4)  					Sleep(500)			'if slot sensors are enabled and checkZ is enabled			If GetOemLED(1152) <> 0 Then				If checkZ <> rackZ Then		'check in checkZ position if enabled					If err_lvl > 2 Then Message "ATC - Moving to CheckZ. Tool T" & newtool & " should be out of Slot " & newslot-1100					sleep 50					code "G1 G53 Z" & checkZ & " F" & tcfeed		'intoarcem scula in furca slotului aferent						While IsMoving()						Wend					'daca sloturile au senzori (adica avem rackZ <> checkZ)					If checkSlot(newslot,1,"Loaded Tool " & newtool & " should NOT be in Slot " & newslot-1100) <> 1 Then						DoOEMButton(1021)						Exit Sub					End If				Else	'check in rackZ position if checkZ = rackZ 					If checkSlot(newslot,1,"Loaded Tool " & newtool & " should NOT be in Slot " & newslot-1100) <> 1 Then						DoOEMButton(1021)						Exit Sub					End If				End If	'end If checkZ <> rackZ cu verificare stare slot inclusa			End If					sleep(50)						'semnalizare leduri stare scula			setuserled(newslot+500,0)	'ledul gri stins, slotul ocupat			setuserled(newslot+300,1)	'aprindem ledul galben, scula in spindle			setoemdro(1729,newtool)		'setare scula in camp editare ptr tool table								If rackAxis = 0 Then	' 0 means rack on X-Axis				If err_lvl > 3 Then Message "ATC - Moving out of the fork"				code "G1 G53 Y" & clearY & " F" & tcfeed					While IsMoving() 					Wend			Else				If err_lvl > 3 Then Message "ATC - Moving out of the fork"				code "G1 G53 X" & clearY & " F" & tcfeed					While IsMoving() 					Wend			End If			If err_lvl > 2 Then Message "ATC - Tool T" & newtool & " loaded!"			code "G1 G53 Z" & clearZ & " F" & tcfeed				While IsMoving() 				Wend				End If	'end If newtool = getoemdro(nnn)	Next nnnEnd If	'end if newtool > 0	If newslot = 0 And newtool > 0 Then 	If err_lvl > 0 Then Message "Moving Spindle in TCP for manual tool loading operations!"	'moving toTC position	Call RunScript("ScreenSetMacros\" & GetActiveScreenSetName() & "\" & "Masters\Scripts\Common\GoTCPosition")	Dim manualadd As Integer	manualadd = MachMsg("Manually add Tool T" & newtool & " in spindle and press OK","Tool not in rack!",1)		If manualadd <> 1 Then 		If err_lvl > 0 Then Message "ATC ERROR! Requested tool not found!"		DoOEMButton(1021)	End If	If manualadd = 1 Then If err_lvl > 1 Then Message "ATC - Tool T" & newtool & " manually loaded!"End If		Exit Sub               'this is the exit of main ATC sub'de aici incep functiile'===================================================================================         	'functie care citeste starea slotuluiFunction checkSlot(slot As Integer, status As Integer, op_desc As String) As Integer	manualconfirm = 0	Dim slotStatus As Integer	'daca senzorii sunt activati 						'sloturile au senzori (adica avem rackZ <> checkZ)	If GetUserLED(1152) <> 0 Then 						'checkZ <> rackZ Then		cnt = 0		If err_lvl > 2 Then Message "ATC - Checking slot " & slot-1100 & " status"		If status = 0 Then checkSlot = 0 	'verificam 0 - raportam 0		If status = 1 Then checkSlot = 1	'verificam 1 - raportam 1		'slotStatus = GetUserLED(slot + 120)		slotStatus = GetUserLED(slot + 200)		Do While slotStatus <> status And cnt < sensorDelay			'slotStatus = GetUserLED(slot + 120)			slotStatus = GetUserLED(slot + 200)			If err_lvl > 3 Then Message "ATC - Checking slot " & slot-1100 & " status - " & Int((sensorDelay-cnt)/1000) & " s"			Sleep 250			cnt = cnt + 250			If cnt >= sensorDelay Then 								'If status = 0 Then manualconfirm = MachMsg("Tool not detected in Slot - Error!","Error",6)				If status = 0 Then manualconfirm = MachMsg(op_desc & Chr(10) & "Tool not detected in Slot " & slot-1100 & " - Error!" & Chr(10) & _					"	CANCEL - Abort process" & Chr(10) & _					"	TRY AGAIN - Re-Check Sensor" & Chr(10) & _					"	CONTINUE - Ignore sensor", _					"Tool not detected in slot " & slot-1100 & "! Error!",6)				'If status = 1 Then manualconfirm = MachMsg("Tool detected in slot - Error!","Error",6)				If status = 1 Then manualconfirm = MachMsg(op_desc & Chr(10) & "Tool detected in Slot " & slot-1100 & " - Error!" & Chr(10) & _					"	CANCEL - Abort process" & Chr(10) & _					"	TRY AGAIN - Re-Check Sensor" & Chr(10) & _					"	CONTINUE - Ignore sensor", _					"Tool detected in Slot " & slot-1100 & "! Error!",6)				If manualconfirm = 2 Then cnt = sensorDelay	'ABORT - adica ii dam valoarea maxima de asteptare care duce in eroare				If manualconfirm = 10 Then cnt = 0		'RETRY - reluam asteptarea ptr verificare senzor				If manualconfirm = 11 Then slotStatus = status	'IGNORE - 			End If		Loop		Sleep 50				If cnt >= sensorDelay And GetUserLED(slot + 200) <> status Then			If status = 0 Then 				checkSlot = 1	'daca verificam 0 si intra in erare se raporteaza 1				If err_lvl > 1 Then If manualconfirm <> 11 Then Message "ATC - No tool in slot " & slot-1100 & " - Error!"				If err_lvl > 2 Then If manualconfirm = 11 Then Message "ATC - Slot " & slot-1100 & " status manually overrided!"			End If							If status = 1 Then 				checkSlot = 0	'daca verificam 1 si intra in erare se raporteaza 0				If err_lvl > 1 Then If manualconfirm <> 11 Then Message "ATC - Slot " & slot-1100 & " not free - Error!"				If err_lvl > 2 Then If manualconfirm = 11 Then Message "ATC - Slot " & slot-1100 & " status manually overrided!"			End If			Sleep 50		End If						'If cnt >= sensorDelay And GetUserLED(slot + 120) <> status Then'		If manualconfirm <> 11 Then If err_lvl > 2 Then Message "ATC - Slot " & slot-1100 & " status OK! Continue..."		If manualconfirm = 11 Then '			If err_lvl > 2 Then Message "ATC - Slot " & slot-1100 & " status manually override! Continue..."			checkSlot = status		End If		If manualconfirm = 2 Then If err_lvl > 2 Then Message "ATC - Manual Aborting TC Procedure! EStop!"		Sleep 50	Else 		If err_lvl > 2 Then Message "ATC - Slots Sensors Disabled! Continuing blind mode!"		If status = 0 Then checkSlot = 0 	'verificam 0 - raportam 0		If status = 1 Then checkSlot = 1	'verificam 1 - raportam 1	End If 'end verificare checkZ <> rackZEnd Function		                                                        